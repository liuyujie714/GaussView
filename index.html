<!doctype html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GaussView</title>
  <style>
    body {
      background: linear-gradient(#efe6d6, #f7f1e6);
      font-family: "Times New Roman", serif, "Georgia";
      color: #2b2b2b;
      padding: 32px;
    }

    .card {
      max-width: 980px;
      margin: 0 auto;
      background: linear-gradient(#fffdf8, #fbf6ec);
      border: 1px solid rgba(60, 40, 20, 0.15);
      box-shadow: 0 8px 24px rgba(40, 30, 20, 0.12), inset 0 1px 0 rgba(255, 255, 255, 0.6);
      border-radius: 10px;
      padding: 22px;
      position: relative;
    }

    h1 {
      margin: 0 0 12px;
      font-size: 22px;
      letter-spacing: 1px;
      color: #3b2b1f;
      text-align: center;
    }

    p.lead {
      margin-top: 0;
      margin-bottom: 16px;
      color: #574635;
      font-size: 14px;
    }

    /* 按钮容器右上角 */
    .top-right-buttons {
      position: absolute;
      top: 16px;
      right: 16px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .btn {
      background: linear-gradient(#f3e2b8, #e8c77a);
      border: 1px solid rgba(80, 50, 20, 0.15);
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 3px 0 rgba(0, 0, 0, 0.08);
      font-size: 13px;
    }

    .btn:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .table-wrap {
      overflow: auto;
      margin-top: 50px;
      /* 给按钮留出空间 */
      border-radius: 6px;
      padding: 8px;
      background: linear-gradient(#fbf7ef, #fbf5ee);
      border: 1px solid rgba(60, 40, 20, 0.06);
    }

    table.vintage {
      border-collapse: collapse;
      width: 100%;
      min-width: 680px;
      font-size: 16px;
      font-weight: 500;
      /* 文字稍微加粗 */
    }

    table.vintage thead th {
      background: linear-gradient(#e9d7b0, #e0c58a);
      color: #2b1f10;
      padding: 10px 12px;
      border: 1px solid rgba(60, 40, 20, 0.12);
      text-align: left;
      font-weight: 700;
      letter-spacing: 0.6px;
    }

    table.vintage tbody td {
      padding: 10px 12px;
      border: 1px solid rgba(60, 40, 20, 0.06);
      background: linear-gradient(transparent, rgba(240, 230, 200, 0.03));
    }

    table.vintage tbody tr:nth-child(odd) td {
      background: linear-gradient(rgba(255, 255, 255, 0.02), transparent);
    }

    caption {
      caption-side: bottom;
      text-align: right;
      padding-top: 8px;
      font-size: 12px;
      color: #6b5a46;
    }

    .hint {
      font-size: 12px;
      color: #7b6a56;
      margin-top: 10px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h1>GaussView 原子判断成键上限阈值</h1>
    <pre class="lead">
  对于不含成键信息的结构文件, GaussView一般有如下成键阈值, <b><font color=red>不同文件格式的单键阈值</font></b>也不同
  比如当读取<b>pdb</b>文件时, C-C原子之间(单位:<b><font color=red>Angstrom</font></b>):
  无键:     d > 1.7956 
  单键:     1.7956 >= d > 1.4476
  共振键:   1.4476 >= d > 1.3860
  双键:     1.3860 >= d > 1.2474
  三键:     d <= 1.2474
    </pre>

    <!-- 按钮固定右上角 -->
    <div class="top-right-buttons">
      <button class="btn" id="copyBtn">复制 CSV</button>
      <button class="btn" id="downloadBtn">下载 CSV</button>
      <button class="btn" id="downloadRadii">下载共价半径</button>
    </div>

    <div class="table-wrap" id="tableWrap" aria-live="polite">
      数据加载中...
    </div>

    <div class="hint">提示：第一行以 <code>#</code> 开头将作为表头；列以任意空白字符分隔。</div>
  </div>

  <script>
    // 固定文本链接
    const primaryUrl = 'https://raw.githubusercontent.com/liuyujie714/GaussView/refs/heads/master/GaussVewBonds.txt';
    const fallbackUrl = 'https://cdn.jsdelivr.net/gh/liuyujie714/GaussView/GaussVewBonds.txt';

    function parseTextToRows(text) {
      const lines = text.split(/\r?\n/).map(l => l.trim()).filter(l => l.length > 0);
      if (lines.length === 0) return { header: [], rows: [] };

      let header = null;
      let startIndex = 0;
      if (lines[0].startsWith('#')) {
        header = lines[0].replace(/^#\s*/, '').trim().split(/\s+/);
        startIndex = 1;
      } else {
        header = lines[0].split(/\s+/);
        startIndex = 1;
      }

      const rows = [];
      for (let i = startIndex; i < lines.length; i++) {
        const cols = lines[i].split(/\s+/);
        while (cols.length < header.length) cols.push('');
        rows.push(cols);
      }
      return { header, rows };
    }

    function renderTable(container, parsed) {
      if (!parsed.header || parsed.header.length === 0) {
        container.innerHTML = '<div class="hint">找不到表头，请确保文本第一行以 <code>#</code> 开头并包含列名。</div>';
        return;
      }

      const table = document.createElement('table');
      table.className = 'vintage';
      const thead = document.createElement('thead');
      const trh = document.createElement('tr');
      parsed.header.forEach(h => {
        const th = document.createElement('th');
        th.textContent = h;
        trh.appendChild(th);
      });
      thead.appendChild(trh);
      table.appendChild(thead);

      const tbody = document.createElement('tbody');
      parsed.rows.forEach(row => {
        const tr = document.createElement('tr');
        for (let i = 0; i < parsed.header.length; i++) {
          const td = document.createElement('td');
          td.textContent = row[i] !== undefined ? row[i] : '';
          tr.appendChild(td);
        }
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);

      const caption = document.createElement('caption');
      caption.textContent = `共 ${parsed.rows.length} 条记录`;
      table.appendChild(caption);

      container.innerHTML = '';
      container.appendChild(table);
    }

    function rowsToCSV(parsed) {
      const esc = s => '"' + String(s).replace(/"/g, '""') + '"';
      const header = parsed.header.map(esc).join(',');
      const body = parsed.rows.map(r => parsed.header.map((_, i) => esc(r[i] ?? '')).join(',')).join('\n');
      return header + '\n' + body;
    }

    function copyCSV(parsed) {
      const csv = rowsToCSV(parsed);
      const textarea = document.createElement('textarea');
      textarea.value = csv;
      document.body.appendChild(textarea);
      textarea.select();
      try {
        document.execCommand('copy'); // 兼容旧浏览器
        alert('已复制 CSV 到剪贴板');
      } catch (err) {
        alert('复制失败，请手动复制');
      }
      document.body.removeChild(textarea);
    }

    function downloadCSV(parsed) {
      const csv = rowsToCSV(parsed);
      const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'GV_Bonds_Critical_Table.csv';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function loadData(url, timeout = 5000) {
      const fetchPromise = fetch(url).then(resp => {
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        return resp.text();
      });

      const timeoutPromise = new Promise((_, reject) =>
        setTimeout(() => reject(new Error('请求超时')), timeout)
      );

      // Promise.race：先完成的 resolve/reject 就决定最终结果
      return Promise.race([fetchPromise, timeoutPromise]);
    }

    loadData(primaryUrl, 5000)  // 5 秒超时
      .then(text => {
        parsedData = parseTextToRows(text);
        renderTable(document.getElementById('tableWrap'), parsedData);
      })
      .catch(err => {
        console.warn('主链接加载失败，尝试备用链接：', err);
        loadData(fallbackUrl, 5000) // 备用链接也加超时
          .then(text => {
            parsedData = parseTextToRows(text);
            renderTable(document.getElementById('tableWrap'), parsedData);
          })
          .catch(err2 => {
            document.getElementById('tableWrap').textContent =
              '读取文件失败（主/备用链接均失败）：' + err2;
          });
      });

    document.getElementById('copyBtn').addEventListener('click', () => {
      if (parsedData) copyCSV(parsedData);
    });
    document.getElementById('downloadBtn').addEventListener('click', () => {
      if (parsedData) downloadCSV(parsedData);
    });

    document.getElementById('downloadRadii').addEventListener('click', ()=>{ 
      const csv = `H,0.3000
He,1.1600
Li,1.2300
Be,0.8900
B,0.8800
C,0.7700
N,0.7000
O,0.6600
F,0.5800
Ne,0.5500
Na,1.4000
Mg,1.3600
Al,1.2500
Si,1.1700
P,1.0500
S,1.0100
Cl,0.9900
Ar,1.5800
K,2.0300
Ca,1.7400
Sc,1.4400
Ti,1.3200
V,1.2000
Cr,1.1300
Mn,1.1700
Fe,1.1600
Co,1.1600
Ni,1.1500
Cu,1.1700
Zn,1.2500
Ga,1.2500
Ge,1.2200
As,1.2100
Se,1.1700
Br,1.1400
Kr,1.8900
Rb,2.2500
Sr,1.9200
Y,1.6200
Zr,1.4500
Nb,1.3400
Mo,1.2900
Tc,1.2300
Ru,1.2400
Rh,1.2500
Pd,1.2800
Ag,1.3400
Cd,1.4100
In,1.5000
Sn,1.4000
Sb,1.4100
Te,1.3700
I,1.3300
Xe,2.0900
Cs,2.3500
Ba,1.9800
La,1.6900
Ce,1.6500
Pr,1.6500
Nd,1.6400
Pm,1.6400
Sm,1.6600
Eu,1.8500
Gd,1.6100
Tb,1.5900
Dy,1.5900
Ho,1.5800
Er,1.5700
Tm,1.5600
Yb,1.7000
Lu,1.5600
Hf,1.4400
Ta,1.3400
W,1.3000
Re,1.2800
Os,1.2600
Ir,1.2600
Pt,1.2900
Au,1.3400
Hg,1.4400
Tl,1.5500
Pb,1.5400
Bi,1.5200
Po,1.5300
At,1.5200
Rn,1.5300
Fr,2.4500
Ra,2.0200
Ac,1.7000
Th,1.6300
Pa,1.4600
U,1.4000
Np,1.3600
Pu,1.2500
Am,1.5700
Cm,1.5800
Bk,1.5400
Cf,1.5300
Es,1.8400
Fm,1.6100
Md,1.5000
No,1.4900
Lr,1.3800
Rf,1.3600
Db,1.2600
Sg,1.2000
Bh,1.1600
Hs,1.1400
Mt,1.0600
Ds,1.2800
Rg,1.2100`;
      const blob = new Blob(["\uFEFF" + csv], { type: 'text/csv;charset=utf-8;' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'GV_CovalRadii.csv';
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    })
  </script>
</body>

</html>